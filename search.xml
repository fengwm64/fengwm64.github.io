<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>[部署]WSL2 深度学习环境配置记录</title>
      <link href="/2025/02/01/%E9%83%A8%E7%BD%B2-WSL2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/"/>
      <url>/2025/02/01/%E9%83%A8%E7%BD%B2-WSL2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="0-调整-WSL2-网络设置"><a href="#0-调整-WSL2-网络设置" class="headerlink" title="0. 调整 WSL2 网络设置"></a>0. 调整 WSL2 网络设置</h1><ul><li><p>搜索 <code>WSL Settings</code><br><img src="https://raw.githubusercontent.com/fengwm64/imgs/main/imgs/20250201231525.png" alt="20250201231525"></p></li><li><p><code>网络</code> 选项卡</p></li><li><p>网络模式设置为 <code>Mirrored</code><br><img src="https://raw.githubusercontent.com/fengwm64/imgs/main/imgs/20250201231635.png" alt="20250201231635"></p></li><li><p>终端输入 <code>wsl --shutdown; wsl</code> 重启 WSL</p></li></ul><h1 id="1-安装-miniconda"><a href="#1-安装-miniconda" class="headerlink" title="1. 安装 miniconda"></a>1. 安装 miniconda</h1><ul><li>官方安装指南：<a href="https://docs.anaconda.com/miniconda/install/#quick-command-line-install">https://docs.anaconda.com/miniconda/install/#quick-command-line-install</a></li></ul><p>具体命令如下：</p><ul><li><code>mkdir -p ~/miniconda3</code></li><li><code>wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh</code></li><li><code>bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3</code></li><li><code>rm ~/miniconda3/miniconda.sh</code></li><li><code>source ~/miniconda3/bin/activate</code></li><li><code>conda init --all</code></li></ul><h1 id="2-安装-CUDA"><a href="#2-安装-CUDA" class="headerlink" title="2. 安装 CUDA"></a>2. 安装 CUDA</h1><h2 id="2-1-检查驱动"><a href="#2-1-检查驱动" class="headerlink" title="2.1 检查驱动"></a>2.1 检查驱动</h2><ul><li>WSL中输入：<code>nvidia-smi</code><blockquote><p>正常来说，在Windows系统上安装了Nvidia显卡驱动，WSL里无需手动安装驱动。正常输出如下：<br><img src="https://raw.githubusercontent.com/fengwm64/imgs/main/imgs/20250201232800.png" alt="20250201232800"></p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WSL2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]Spark-4 运行Spark程序</title>
      <link href="/2024/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-4/"/>
      <url>/2024/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-4/</url>
      
        <content type="html"><![CDATA[<p>经典的<code>WordCount</code>程序源码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.edu.ecnu.spark.example.java.wordcount;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.JavaSparkContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function.*;</span><br><span class="line"><span class="keyword">import</span> scala.Tuple2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WordCount</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/* 步骤1：通过SparkConf设置配置信息，并创建SparkContext */</span></span><br><span class="line">        <span class="type">SparkConf</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SparkConf</span>();</span><br><span class="line">        conf.setAppName(<span class="string">&quot;WordCount&quot;</span>);</span><br><span class="line">        <span class="type">JavaSparkContext</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JavaSparkContext</span>(conf);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 步骤2：按应用逻辑使用操作算子编写DAG，其中包括RDD的创建、转换和行动等 */</span></span><br><span class="line">        <span class="comment">// 读入文本数据，创建名为lines的RDD</span></span><br><span class="line">        JavaRDD&lt;String&gt; lines = sc.textFile(args[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将lines中的每一个文本行按空格分割成单个单词</span></span><br><span class="line">        JavaRDD&lt;String&gt; words = lines.flatMap(<span class="keyword">new</span> <span class="title class_">FlatMapFunction</span>&lt;String, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Iterator&lt;String&gt; <span class="title function_">call</span><span class="params">(String line)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="keyword">return</span> Arrays.asList(line.split(<span class="string">&quot; &quot;</span>)).iterator();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 将每个单词的频数设置为1，即将每个单词映射为[单词, 1]</span></span><br><span class="line">        JavaPairRDD&lt;String, Integer&gt; pairs = words.mapToPair(<span class="keyword">new</span> <span class="title class_">PairFunction</span>&lt;String, String, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title function_">call</span><span class="params">(String word)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Tuple2</span>&lt;String, Integer&gt;(word, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 按单词聚合，并对相同单词的频数使用sum进行累计</span></span><br><span class="line">        JavaPairRDD&lt;String, Integer&gt; wordCounts = pairs.groupByKey().mapToPair(<span class="keyword">new</span> <span class="title class_">PairFunction</span>&lt;Tuple2&lt;String, Iterable&lt;Integer&gt;&gt;, String, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title function_">call</span><span class="params">(Tuple2&lt;String, Iterable&lt;Integer&gt;&gt; t)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> Integer.valueOf(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">for</span> (Integer i : t._2) &#123;</span><br><span class="line">                    sum += i;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Tuple2</span>&lt;String, Integer&gt;(t._1, sum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 合并机制</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        JavaPairRDD&lt;String, Integer&gt; wordCounts =</span></span><br><span class="line"><span class="comment">        pairs.reduceByKey(</span></span><br><span class="line"><span class="comment">            new Function2&lt;Integer, Integer, Integer&gt;() &#123;</span></span><br><span class="line"><span class="comment">              @Override</span></span><br><span class="line"><span class="comment">              public Integer call(Integer t1, Integer t2) throws Exception &#123;</span></span><br><span class="line"><span class="comment">                return t1 + t2;</span></span><br><span class="line"><span class="comment">              &#125;</span></span><br><span class="line"><span class="comment">            &#125;);</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出词频统计结果</span></span><br><span class="line">        wordCounts.saveAsTextFile(args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 步骤3：关闭SparkContext */</span></span><br><span class="line">        sc.stop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="1-新建maven项目"><a href="#1-新建maven项目" class="headerlink" title="1 新建maven项目"></a>1 新建maven项目</h1><ul><li>在<code>idea</code>新建项目：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021832587.png"></p><ul><li><code>pom.xml</code>内容如下：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-wordcount<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spark.version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">spark.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>更新依赖</li></ul><h1 id="2-新建-Java-代码"><a href="#2-新建-Java-代码" class="headerlink" title="2 新建 Java 代码"></a>2 新建 Java 代码</h1><ul><li>新建包<code>cn.edu.ecnu.spark.example.java.wordcount</code>，类<code>WordCount</code>:</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021833109.png"></p><h1 id="3-打包"><a href="#3-打包" class="headerlink" title="3 打包"></a>3 打包</h1><ul><li>打包为<code>.jar</code>:</li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021759128.png"></p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021800838.png"></p><h1 id="4-传送到客户端"><a href="#4-传送到客户端" class="headerlink" title="4 传送到客户端"></a>4 传送到客户端</h1><ul><li>将打包好的<code>.jar</code>(位置<code>项目路径\out\artifacts\spark_wordcount_jar</code>)传到<strong>客户端</strong>的<code>/home/dase-dis/spark-2.4.7/myapp</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021803426.png"></p><h1 id="5-下载测试数据"><a href="#5-下载测试数据" class="headerlink" title="5 下载测试数据"></a>5 下载测试数据</h1><ul><li><p>下载：<code>wget https://github.com/ymcui/Chinese-Cloze-RC/archive/master.zip</code></p></li><li><p>解压：<code>unzip master.zip</code></p></li><li><p>解压：<code>unzip ~/Chinese-Cloze-RC-master/people_daily/pd.zip</code></p></li><li><p>拷贝到集群：<code>~/hadoop-2.10.1/bin/hdfs dfs -put ~/Chinese-Cloze-RC-master/people_daily/pd/pd.test spark_input/pd.test</code></p></li></ul><h1 id="6-提交jar任务"><a href="#6-提交jar任务" class="headerlink" title="6 提交jar任务"></a>6 提交jar任务</h1><ul><li><p>删除输出文件夹：<code>~/hadoop-2.10.1/bin/hdfs dfs -rm -r spark_output</code></p></li><li><p>提交任务：<code>~/spark-2.4.7/bin/spark-submit \ --master spark://ecnu01:7077 \ --class cn.edu.ecnu.spark.example.java.wordcount.WordCount \ /home/dase-dis/spark-2.4.7/myapp/spark-wordcount.jar hdfs://ecnu01:9000/user/dase-dis/spark_input hdfs://ecnu01:9000/user/dase-dis/spark_output</code></p></li></ul><p>正在运行</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021816280.png"></p><p><strong>顺利跑完</strong></p><p>ssh：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021831459.png"></p><p>webui：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021830147.png"></p><p>查看<code>output</code>文件夹:</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021931447.png"></p><p>查看<code>part01</code>运行结果：</p><ul><li><code>./hadoop-2.10.1/bin/hdfs dfs -cat /user/dase-dis/spark_output/part-00001</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021934024.png"></p>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]Spark-3 Spark部署</title>
      <link href="/2024/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-3/"/>
      <url>/2024/05/02/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-3/</url>
      
        <content type="html"><![CDATA[<h1 id="1-修改配置文件"><a href="#1-修改配置文件" class="headerlink" title="1.修改配置文件"></a>1.修改配置文件</h1><h2 id="1-1-修改-bashrc文件"><a href="#1-1-修改-bashrc文件" class="headerlink" title="1.1 修改.bashrc文件"></a>1.1 修改.bashrc文件</h2><p><strong>客户端</strong>执行：</p><ul><li><p><code>vi ~/.bashrc</code></p></li><li><p>按<code>i</code>进入编辑模式，按方向键到文件最后一行，输入<code>export TERM=xterm-color</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404292240144.png"></p><ul><li><p>按<code>Esc</code>键退出编辑模式，输入<code>:wq</code>保存退出</p></li><li><p>使<code>.bashrc</code>配置生效：<code>source ~/.bashrc</code></p></li></ul><h2 id="1-2-下载-spark"><a href="#1-2-下载-spark" class="headerlink" title="1.2 下载 spark"></a>1.2 下载 spark</h2><p>在<strong>主节点</strong>执行:</p><ul><li><p>启动HDFS服务(已经启动直接下一步):<code>~/hadoop-2.10.1/sbin/start-dfs.sh</code></p></li><li><p>下载Spark安装包：<code>wget http://archive.apache.org/dist/spark/spark-2.4.7/spark-2.4.7-bin-without-hadoop.tgz</code></p></li><li><p>解压安装包：<code>tar -zxvf spark-2.4.7-bin-without-hadoop.tgz</code></p></li><li><p>改名：<code>mv ~/spark-2.4.7-bin-without-hadoop ~/spark-2.4.7</code></p></li></ul><p>上述步骤完成后：<br><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404292257700.png"></p><h2 id="1-3-修改配置"><a href="#1-3-修改配置" class="headerlink" title="1.3 修改配置"></a>1.3 修改配置</h2><p>在<strong>主节点</strong>执行以下修改:</p><h3 id="1-3-1-spark-env"><a href="#1-3-1-spark-env" class="headerlink" title="1.3.1 spark-env"></a>1.3.1 spark-env</h3><ul><li><p><code>cp /home/dase-dis/spark-2.4.7/conf/spark-env.sh.template /home/dase-dis/spark-2.4.7/conf/spark-env.sh</code></p></li><li><p><code>vi /home/dase-dis/spark-2.4.7/conf/spark-env.sh</code></p></li></ul><p>修改为:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为下载的是Hadoop Free版本的Spark, 所以需要配置Hadoop的路径</span></span><br><span class="line">export HADOOP_HOME=/home/dase-dis/hadoop-2.10.1</span><br><span class="line">export SPARK_DIST_CLASSPATH=$($HADOOP_HOME/bin/hadoop classpath)</span><br><span class="line">export LD_LIBRARY_PATH=$HADOOP_HOME/lib/native:$LD_LIBRARY_PATH</span><br><span class="line"></span><br><span class="line">export SPARK_MASTER_HOST=ecnu01 #主节点主机名</span><br><span class="line">export SPARK_MASTERPORT=7077    #端口号</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405020927048.png"></p><h3 id="1-3-2-slaves"><a href="#1-3-2-slaves" class="headerlink" title="1.3.2 slaves"></a>1.3.2 slaves</h3><ul><li><p><code>cp spark-2.4.7/conf/slaves.template spark-2.4.7/conf/slaves</code></p></li><li><p><code>vi spark-2.4.7/conf/slaves</code></p></li></ul><p>修改为:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">localhost</span></span><br><span class="line">ecnu02</span><br><span class="line">ecnu03</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405020930661.png"></p><h3 id="1-3-3-spark-defaults"><a href="#1-3-3-spark-defaults" class="headerlink" title="1.3.3 spark-defaults"></a>1.3.3 spark-defaults</h3><ul><li><p><code>cp spark-2.4.7/conf/spark-defaults.conf.template spark-2.4.7/conf/spark-defaults.conf</code></p></li><li><p><code>vi spark-2.4.7/conf/spark-defaults.conf</code></p></li></ul><p>修改为:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spark.eventLog.enabled=true</span><br><span class="line">spark.eventLog.dir=hdfs://ecnu01:9000/tmp/spark_history</span><br><span class="line">spark.history.fs.logDirectory=hdfs://ecnu01:9000/tmp/spark_history</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405020941828.png"></p><h3 id="1-3-4-spark-config"><a href="#1-3-4-spark-config" class="headerlink" title="1.3.4 spark-config"></a>1.3.4 spark-config</h3><ul><li><code>vi spark-2.4.7/sbin/spark-config.sh</code></li></ul><p>追加:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/home/dase-dis/jdk1.8.0_202</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405020945282.png"></p><h1 id="2-安装spark"><a href="#2-安装spark" class="headerlink" title="2.安装spark"></a>2.安装spark</h1><h2 id="2-1-拷贝"><a href="#2-1-拷贝" class="headerlink" title="2.1 拷贝"></a>2.1 拷贝</h2><p>本步骤将spark修改好的安装包拷贝到其他三台机:</p><ul><li><p><code>scp -r spark-2.4.7 dase-dis@ecnu02:~/</code></p></li><li><p><code>scp -r spark-2.4.7 dase-dis@ecnu03:~/</code></p></li><li><p><code>scp -r spark-2.4.7 dase-dis@ecnu04:~/</code></p></li></ul><h2 id="2-2-HDFS中建立日志目录"><a href="#2-2-HDFS中建立日志目录" class="headerlink" title="2.2 HDFS中建立日志目录"></a>2.2 HDFS中建立日志目录</h2><ul><li><code>~/hadoop-2.10.1/bin/hdfs dfs -mkdir -p /tmp/spark_history</code></li></ul><h2 id="2-3-启动-spark"><a href="#2-3-启动-spark" class="headerlink" title="2.3 启动 spark"></a>2.3 启动 spark</h2><p>千辛万苦, 终于到启动了<br><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021003091.png" alt="" width="25%"></p><p>在<strong>主节点</strong>执行:</p><ul><li><p>启动spark: <code>~/spark-2.4.7/sbin/start-all.sh</code></p></li><li><p>启动日志服务器: <code>~/spark-2.4.7/sbin/start-history-server.sh</code></p></li><li><p><strong>主节点:</strong></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021043271.png"></p><ul><li><strong>从节点:</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021047418.png"></p><p><strong>错误处理:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">dase-dis@ecnu01:~$ ~/spark-2.4.7/sbin/start-all.sh</span><br><span class="line">starting org.apache.spark.deploy.master.Master, logging to /home/dase-dis/spark-2.4.7/logs/spark-dase-dis-org.apache.spark.deploy.master.Master-1-ecnu01.out</span><br><span class="line">ecnu02: starting org.apache.spark.deploy.worker.Worker, logging to /home/dase-dis/spark-2.4.7/logs/spark-dase-dis-org.apache.spark.deploy.worker.Worker-1-ecnu02.out</span><br><span class="line">ecnu03: starting org.apache.spark.deploy.worker.Worker, logging to /home/dase-dis/spark-2.4.7/logs/spark-dase-dis-org.apache.spark.deploy.worker.Worker-1-ecnu03.out</span><br><span class="line">ecnu02: failed to launch: nice -n 0 /home/dase-dis/spark-2.4.7/bin/spark-class org.apache.spark.deploy.worker.Worker --webui-port 8081 spark://172.19.39.254:7077</span><br><span class="line">ecnu02:         at io.netty.channel.AbstractChannel.bind(AbstractChannel.java:248)</span><br><span class="line">ecnu02:         at io.netty.bootstrap.AbstractBootstrap$2.run(AbstractBootstrap.java:356)</span><br><span class="line">ecnu02:         at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)</span><br><span class="line">ecnu02:         at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)</span><br><span class="line">ecnu02:         at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:500)</span><br><span class="line">ecnu02:         at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)</span><br><span class="line">ecnu02:         at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)</span><br><span class="line">ecnu02:         at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)</span><br><span class="line">ecnu02:         at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">ecnu02:   24/05/02 10:23:10 INFO util.ShutdownHookManager: Shutdown hook called</span><br><span class="line">ecnu02: full log in /home/dase-dis/spark-2.4.7/logs/spark-dase-dis-org.apache.spark.deploy.worker.Worker-1-ecnu02.out</span><br></pre></td></tr></table></figure><p><strong>请检查hosts文件设置, 文章<code>[大数据]Spark-1 SSH &amp; JDK部署</code></strong></p><h2 id="2-4-验证"><a href="#2-4-验证" class="headerlink" title="2.4 验证"></a>2.4 验证</h2><p>浏览器访问: <code>http://主节点IP:8080/</code>，（<strong>如果主节点是云服务器记得把防火墙打开</strong>）</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021116322.png"></p><p>可以看到有两个worker在线, <strong>大功告成</strong></p><h1 id="3-运行spark应用程序"><a href="#3-运行spark应用程序" class="headerlink" title="3.运行spark应用程序"></a>3.运行spark应用程序</h1><p>好不容易搞好了, 来玩一下: </p><h2 id="3-1-创建文件夹-上传文件"><a href="#3-1-创建文件夹-上传文件" class="headerlink" title="3.1 创建文件夹&amp;上传文件"></a>3.1 创建文件夹&amp;上传文件</h2><ul><li><p>创建<code>spark_input</code>文件夹: <code>~/hadoop-2.10.1/bin/hdfs dfs -mkdir -p spark_input</code></p></li><li><p>上传文件<code>RELEASE</code>到<code>spark_input</code>: <code>~/hadoop-2.10.1/bin/hdfs dfs -put ~/spark-2.4.7/RELEASE spark_input/</code></p></li></ul><p>在<code>hadood</code>的页面可以看到, 文件<code>RELEASE</code>存储在两个节点中: </p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021152426.png"></p><h2 id="3-2-启动-Spark-Shell"><a href="#3-2-启动-Spark-Shell" class="headerlink" title="3.2 启动 Spark Shell"></a>3.2 启动 Spark Shell</h2><ul><li>启动<code>spark-shell</code>: <code>~/spark-2.4.7/bin/spark-shell --master spark://ecnu01:7077</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021309487.png"></p><ul><li>键入以下<code>Scala</code>代码:</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> sc = spark.sparkContext</span><br><span class="line"><span class="keyword">val</span> textFile = sc.textFile(<span class="string">&quot;hdfs://ecnu01:9000/user/dase-dis/spark_input/RELEASE&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> counts = textFile.flatMap(line =&gt; line.split(<span class="string">&quot; &quot;</span>)).map(word =&gt; (word, <span class="number">1</span>)).reduceByKey(_ + _)</span><br><span class="line">counts.collect().foreach(println)</span><br></pre></td></tr></table></figure><p>shell输出:</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021317280.png"></p><p>可以在网页查看到正在运行的任务信息:</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021310029.png"></p><p>到此Spark集群就已经顺利搭建完毕了</p><h1 id="4-停止集群"><a href="#4-停止集群" class="headerlink" title="4.停止集群"></a>4.停止集群</h1><p>如果你希望停止集群:</p><ul><li><p>停止<code>Spark</code>: <code>/spark-2.4.7/sbin/stop-all.sh</code></p></li><li><p>停止<code>Spark</code>日志服务: <code>/spark-2.4.7/sbin/stop-history-server.sh</code></p></li><li><p>停止<code>HDFS</code>服务: <code>/hadoop-2.10.1/sbin/stop-dfs.sh</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]Spark-2 Hadoop 2.x部署</title>
      <link href="/2024/04/30/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-2/"/>
      <url>/2024/04/30/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-2/</url>
      
        <content type="html"><![CDATA[<p>请确保已经完成1</p><h1 id="1-下载"><a href="#1-下载" class="headerlink" title="1.下载"></a>1.下载</h1><p>地址：<a href="https://archive.apache.org/dist/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz">https://archive.apache.org/dist/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz</a></p><p><strong>在主节点上执行：</strong></p><ul><li><p>下载:<code>wget https://archive.apache.org/dist/hadoop/common/hadoop-2.10.1/hadoop-2.10.1.tar.gz</code></p></li><li><p>解压:<code>tar -zxvf hadoop-2.10.1.tar.gz</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301317432.png"></p><ul><li><p>进入文件夹:<code>cd ~/hadoop-2.10.1/</code></p></li><li><p>查看下载软件的版本:<code>./bin/hadoop version</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301319210.png"></p><h1 id="2-修改配置"><a href="#2-修改配置" class="headerlink" title="2.修改配置"></a>2.修改配置</h1><h2 id="2-1-修改slaves"><a href="#2-1-修改slaves" class="headerlink" title="2.1 修改slaves"></a>2.1 修改slaves</h2><p><strong>在主节点上执行：</strong></p><ul><li>修改 slaves 文件: <code>vim ~/hadoop-2.10.1/etc/hadoop/slaves</code></li></ul><p>修改为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ecnu02</span><br><span class="line">ecnu03</span><br></pre></td></tr></table></figure><h2 id="2-2-修改core-site"><a href="#2-2-修改core-site" class="headerlink" title="2.2 修改core-site"></a>2.2 修改core-site</h2><ul><li>修改 core-site.xml: <code>vim ~/hadoop-2.10.1/etc/hadoop/core-site.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/dase-dis/hadoop-2.10.1/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--以下填写主节点主机名--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://ecnu01:9999<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301329297.png"></p><h2 id="2-3-修改hdfs-site"><a href="#2-3-修改hdfs-site" class="headerlink" title="2.3 修改hdfs-site"></a>2.3 修改hdfs-site</h2><ul><li>修改 hdfs-site.xml: <code>vim ~/hadoop-2.10.1/etc/hadoop/hdfs-site.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment">  you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment">  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License. See accompanying LICENSE file.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Put site-specific property overrides in this file. --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/home/dase-dis/hadoop-2.10.1/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/home/dase-dis/hadoop-2.10.1/tmp/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-4-修改hadoop-env"><a href="#2-4-修改hadoop-env" class="headerlink" title="2.4 修改hadoop-env"></a>2.4 修改hadoop-env</h2><ul><li><p>修改 hadoop-env.sh: <code>vim ~/hadoop-2.10.1/etc/hadoop/hadoop-env.sh</code></p></li><li><p>将<code>JAVA_HOME</code>改为：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/home/dase-dis/jdk1.8.0_202</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301434373.png"></p><h2 id="2-5-拷贝安装包"><a href="#2-5-拷贝安装包" class="headerlink" title="2.5 拷贝安装包"></a>2.5 拷贝安装包</h2><p>好了好了，终于改完了，接下来将改好的这份hadoop拷贝到其余三台机：</p><ul><li><p>拷贝到从节点1：<code>scp -r /home/dase-dis/hadoop-2.10.1 dase-dis@ecnu02:/home/dase-dis/</code></p></li><li><p>拷贝到从节点2：<code>scp -r /home/dase-dis/hadoop-2.10.1 dase-dis@ecnu03:/home/dase-dis/</code></p></li><li><p>拷贝到客户端：<code>scp -r /home/dase-dis/hadoop-2.10.1 dase-dis@ecnu04:/home/dase-dis/</code></p></li></ul><p>其实打包一下拷贝会更加好的，这里偷懒了</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301352765.png"></p><h1 id="3-启动HDFS服务"><a href="#3-启动HDFS服务" class="headerlink" title="3.启动HDFS服务"></a>3.启动HDFS服务</h1><h2 id="3-1-格式化"><a href="#3-1-格式化" class="headerlink" title="3.1 格式化"></a>3.1 格式化</h2><blockquote><p><strong>注意:</strong> 仅在第一次启动 HDFS 时才需要格式化 NameNode，如果是重启HDFS那么跳过这步，直接执行下一步即可。<br>此外，在进行 NameNode 格式化之前，如果~&#x2F;hadoop-2.10.1&#x2F;tmp&#x2F;文件夹已存在，那么需要删除该文件夹后再执行以下格式化命令。</p><p><strong>如果启动时炸了，CTRL+C了，断电了，请参考后文解决办法，可能仍然需要格式化</strong></p></blockquote><ul><li>格式化命令: <code>~/hadoop-2.10.1/bin/hdfs namenode -format</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301427369.png"></p><hr><h2 id="3-2-启动"><a href="#3-2-启动" class="headerlink" title="3.2 启动"></a>3.2 启动</h2><ul><li>启动：<code>~/hadoop-2.10.1/sbin/start-dfs.sh</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301505902.png"></p><hr><h2 id="3-3-验证"><a href="#3-3-验证" class="headerlink" title="3.3 验证"></a>3.3 验证</h2><ul><li><p>验证：<code>jps</code></p></li><li><p><strong>主节点</strong></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301620529.png"></p><ul><li><strong>从节点</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301509565.png"></p><hr><p>浏览器访问<code>http://主节点IP:50070/</code>，（<strong>如果主节点是云服务器记得把防火墙打开</strong>）</p><p>开防火墙：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301515606.png"></p><p>集群工作正常：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301622499.png"></p><p>查看节点信息：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301624181.png"></p><h2 id="3-4-集群异常解决"><a href="#3-4-集群异常解决" class="headerlink" title="3.4 集群异常解决"></a>3.4 集群异常解决</h2><ol><li>如果因为一些情况导致集群第一次没有启动成功，请在主、从节点：</li></ol><ul><li><p>在<strong>主节点</strong>, 停止集群：<code>~/hadoop-2.10.1/sbin/stop-dfs.sh</code></p></li><li><p>删除运行生成文件：<code>cd ~/hadoop-2.10.1/tmp/dfs &amp;&amp; rm -rf *</code></p></li><li><p>删除日志：<code>cd ~/hadoop-2.10.1/logs &amp;&amp; rm -rf *</code></p></li><li><p>解决端口占用：<code>sudo reboot</code></p></li><li><p>在<strong>主节点</strong>, 重新执行格式化命令：<code>~/hadoop-2.10.1/bin/hdfs namenode -format</code></p></li></ul><hr><ol start="2"><li><strong>云服务器可能会出现的错误</strong></li></ol><ul><li><strong>错误日志：</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301613498.png"></p><ul><li><p>提示绑定错误或<code>2024-04-30 16:06:52,547 INFO org.apache.hadoop.util.ExitUtil: Exiting with status 1: java.net.BindException: Problem binding to [ecnu01:9000] java.net.BindException: Cannot assign requested address; For more details see:  http://wiki.apache.org/hadoop/BindException</code>的</p></li><li><p>检查文章<code>spark-1</code> 中提到的hosts设置是否正确, 设置好了不会出现这种情况</p></li><li><p><strong>参考：</strong></p></li></ul><ol><li><p><a href="https://blog.csdn.net/xiaosa5211234554321/article/details/119627974">https://blog.csdn.net/xiaosa5211234554321/article/details/119627974</a></p></li><li><p><a href="https://cwiki.apache.org/confluence/display/HADOOP2/BindException">https://cwiki.apache.org/confluence/display/HADOOP2/BindException</a></p></li></ol><h1 id="4-HDFS-Shell"><a href="#4-HDFS-Shell" class="headerlink" title="4.HDFS Shell"></a>4.HDFS Shell</h1><blockquote><p>注意:第一次使用 HDFS 时,需要首先在 HDFS 中创建用户目录</p></blockquote><ul><li><p>打开工作目录: <code>cd ~/hadoop-2.10.1</code></p></li><li><p>为当前 dase-dis 用户创建一个用户根目录: <code>./bin/hdfs dfs -mkdir -p /user/dase-dis</code></p></li></ul><p>HDFS Shell目录操作示例:</p><ul><li><p>显示 hdfs:&#x2F;&#x2F;&#x2F;user&#x2F;dase-dis 下的文件: <code>./bin/hdfs dfs -ls /user/dase-dis</code></p></li><li><p>新建 hdfs:&#x2F;&#x2F;&#x2F;user&#x2F;dase-dis&#x2F;input 目录: <code>./bin/hdfs dfs -mkdir /user/dase-dis/input</code></p></li><li><p>删除 hdfs:&#x2F;&#x2F;&#x2F;user&#x2F;dase-dis&#x2F;input 目录: <code>./bin/hdfs dfs -rm -r /user/dase-dis/input</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]Spark-1 SSH &amp; JDK部署</title>
      <link href="/2024/04/28/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-1/"/>
      <url>/2024/04/28/%E5%A4%A7%E6%95%B0%E6%8D%AE-Spark-1/</url>
      
        <content type="html"><![CDATA[<p>如果不熟悉Linux命令行就不要看了</p><h1 id="1-互联互通"><a href="#1-互联互通" class="headerlink" title="1.互联互通"></a>1.互联互通</h1><p>在哥们(hhh)的帮助下，搞到四台阿里云服务器，不过挺寒碜的配置：</p><table><thead><tr><th align="center">编号</th><th align="center">IP</th><th align="center">用户名</th><th align="center">密码</th><th align="center">系统配置</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">8.219.xx0.46</td><td align="center">root</td><td align="center">—-</td><td align="center">Ubuntu 22.04 | 2vCPU&#x2F;4GiB</td><td align="center">主节点</td></tr><tr><td align="center">2</td><td align="center">4x.236.2x.161</td><td align="center">root</td><td align="center">—-</td><td align="center">Ubuntu 22.04 | 2vCPU&#x2F;1GiB</td><td align="center">从节点</td></tr><tr><td align="center">3</td><td align="center">4x.236.15x.1x2</td><td align="center">root</td><td align="center">—-</td><td align="center">Ubuntu 22.04 | 2vCPU&#x2F;2GiB</td><td align="center">从节点</td></tr><tr><td align="center">4</td><td align="center">47.2x6.x15.x57</td><td align="center">root</td><td align="center">—-</td><td align="center">Ubuntu 22.04 | 2vCPU&#x2F;1GiB</td><td align="center">客户端</td></tr></tbody></table><h2 id="1-1-创建用户"><a href="#1-1-创建用户" class="headerlink" title="1.1 创建用户"></a>1.1 创建用户</h2><p>写了一个shell脚本，在四台服务器上创建用户<code>dase-dis</code>（注意确保四台服务器的用户名和密码一致才可以使用）:</p><p>先<code>sudo apt install sshpass</code>，在Linux下执行脚本：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器IP地址列表</span></span><br><span class="line">ip_list=(<span class="string">&quot;xxxx&quot;</span> <span class="string">&quot;xxxx&quot;</span> <span class="string">&quot;xxxx&quot;</span> <span class="string">&quot;xxxx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置统一的密码</span></span><br><span class="line">password=<span class="string">&quot;admin&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历IP地址列表</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;ip_list[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Connecting to <span class="variable">$ip</span>...&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接服务器并创建用户</span></span><br><span class="line">    sshpass -p <span class="string">&quot;<span class="variable">$ssh_password</span>&quot;</span> ssh -o StrictHostKeyChecking=no root@<span class="variable">$ip</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">        # 创建用户并设置密码</span></span><br><span class="line"><span class="string">        useradd -m -s /bin/bash dase-dis</span></span><br><span class="line"><span class="string">        echo &quot;dase-dis:$password&quot; | chpasswd</span></span><br><span class="line"><span class="string">        # 添加用户到sudo组</span></span><br><span class="line"><span class="string">        usermod -aG sudo dase-dis</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;User dase-dis created on <span class="variable">$ip</span> with password <span class="variable">$password</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>执行结果：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404282346549.png"></p><hr><h2 id="1-2-服务器之间免密登录"><a href="#1-2-服务器之间免密登录" class="headerlink" title="1.2 服务器之间免密登录"></a>1.2 服务器之间免密登录</h2><p>实现四台服务器之间ssh免密登录</p><h3 id="1-2-1-安装openssh"><a href="#1-2-1-安装openssh" class="headerlink" title="1.2.1 安装openssh"></a>1.2.1 安装openssh</h3><p>在四台服务器上执行</p><ul><li><code>sudo apt-get install openssh-server</code> 安装openssh</li></ul><h3 id="1-2-2-更改主机名"><a href="#1-2-2-更改主机名" class="headerlink" title="1.2.2 更改主机名"></a>1.2.2 更改主机名</h3><p>在1号机（主节点，在文章开头编号1）执行：</p><ul><li><code>sudo hostnamectl set-hostname ecnu01</code> 更改主机名</li></ul><p>在2号机（从节点，在文章开头编号2）执行：</p><ul><li><code>sudo hostnamectl set-hostname ecnu02</code></li></ul><p>…以此类推</p><ul><li><p><code>sudo hostnamectl set-hostname ecnu03</code></p></li><li><p><code>sudo hostnamectl set-hostname ecnu04</code></p></li></ul><p>四台服务器都执行完毕后，断开ssh重新连接，观察到主机名字已经成功更改</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404292322849.png"></p><h3 id="1-2-3-更改hosts"><a href="#1-2-3-更改hosts" class="headerlink" title="1.2.3 更改hosts"></a>1.2.3 更改hosts</h3><p>原理：</p><blockquote><p><code>Hosts</code> 文件是本地计算机上的文本文件，用于将主机名与 <code>IP</code> 地址关联起来,绕过 <code>DNS</code> 解析。<code>Linux hosts</code> 文件的格式通常是：</p><p><code>IP地址    主机名    [别名...]</code></p><p>在 <code>/etc/hosts</code> 路径下，每行代表一个主机名到 <code>IP</code> 地址的映射。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost</span><br><span class="line">::1         localhost</span><br><span class="line">192.168.1.2 example.com</span><br></pre></td></tr></table></figure><p>其中，127.0.0.1 和 ::1 映射到 localhost，192.168.1.2 映射到 example.com。hosts 文件允许手动指定主机名与 IP 地址的对应关系，用于特定网络配置和测试。</p></blockquote><p><strong>开始修改：</strong></p><p>在四台机上执行以下操作：</p><ul><li><code>sudo vim /etc/hosts</code></li></ul><p>在<code>hosts</code>文件后追加（<strong>ip需要改成自己的哇</strong>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># IP地址 主机名</span></span><br><span class="line">8.219.108.46 ecnu01</span><br><span class="line">47.236.20.161 ecnu02</span><br><span class="line">47.236.157.142 ecnu03</span><br><span class="line">47.236.115.157 ecnu04</span><br></pre></td></tr></table></figure><p><strong>!!!!!!!注意!!!!!!!!!</strong><br><strong>!!!!!!!注意!!!!!!!!!</strong><br><strong>!!!!!!!注意!!!!!!!!!</strong></p><p><strong>在云服务器配置时, 本机使用内网IP, 其余为公网IP</strong></p><p>查看内网IP:</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021028165.png"></p><p>hosts数值示例:</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021027955.png"></p><h3 id="1-2-4-拷贝ssh公钥"><a href="#1-2-4-拷贝ssh公钥" class="headerlink" title="1.2.4 拷贝ssh公钥"></a>1.2.4 拷贝ssh公钥</h3><p><strong>在所有机器依次执行下面命令：</strong></p><p>作用是将除主机外的三台机的ssh公钥拷贝到主中，实现其余三台机器到主机的ssh免密登录</p><ul><li><p><code>ssh-keygen -t rsa</code> 生成ssh密钥</p></li><li><p><code>ssh dase-dis@ecnu01 &#39;mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys&#39; &lt; ~/.ssh/id_rsa.pub</code> 发送公钥到主机</p></li><li><p><code>sudo service ssh restart &amp;&amp; chmod 700 ~/.ssh  &amp;&amp; chmod 600 ~/.ssh/authorized_keys</code> 重启本机ssh服务+解决ssh文件夹的权限问题</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404292330151.png"></p><hr><p><strong>主机执行：</strong></p><p>作用是将主机的ssh认证拷贝到其余三台机中，实现其余三台机器之间的ssh免密登录</p><ul><li><p><code>scp ~/.ssh/authorized_keys dase-dis@ecnu02:/home/dase-dis/.ssh/authorized_keys</code></p></li><li><p><code>scp ~/.ssh/authorized_keys dase-dis@ecnu03:/home/dase-dis/.ssh/authorized_keys</code></p></li><li><p><code>scp ~/.ssh/authorized_keys dase-dis@ecnu04:/home/dase-dis/.ssh/authorized_keys</code></p></li></ul><p>上面的三条命令等价于命令：<code>for host in ecnu02 ecnu03 ecnu04; do scp ~/.ssh/authorized_keys dase-dis@$host:/home/dase-dis/.ssh/; done</code></p><p>然后主机执行：</p><p><code>sudo service ssh restart &amp;&amp; chmod 700 ~/.ssh  &amp;&amp; chmod 600 ~/.ssh/authorized_keys</code></p><p>运行结果：</p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404292335551.png"></p><hr><p><strong>验证：</strong></p><p>互相ssh过去看看要不要输入密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssh dase-dis@ecnu01</span><br><span class="line">exit</span><br><span class="line">ssh dase-dis@ecnu02</span><br><span class="line">exit</span><br><span class="line">ssh dase-dis@ecnu03</span><br><span class="line">exit</span><br><span class="line">ssh dase-dis@ecnu04</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h2 id="1-3-关闭防火墙"><a href="#1-3-关闭防火墙" class="headerlink" title="1.3 关闭防火墙"></a>1.3 关闭防火墙</h2><p>如果你是本地虚拟机:</p><ul><li><p><code>systemctl stop firewalld.service</code></p></li><li><p><code>systemctl disable firewalld.service </code></p></li></ul><p>如果你是云服务器:</p><p><strong>请确保你知道自己在干什么, 关闭防火墙(开放所有端口)可能导致服务器被入侵</strong></p><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202405021144615.png"></p><h1 id="2-配置Java环境"><a href="#2-配置Java环境" class="headerlink" title="2.配置Java环境"></a>2.配置Java环境</h1><ul><li>JDK 1.8 <a href="https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html">https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html</a></li></ul><p>在四台机器上配置：</p><p><strong>可能你需要在上面oracle网站登陆后上手动找到下载地址，然后使用wget下载</strong></p><ul><li><p>下载：<code>wget https://download.oracle.com/otn/java/jdk/8u202-b08/1961070e4c9b4e26a04e7f5a083f551e/jdk-8u202-linux-x64.tar.gz</code></p></li><li><p>解压：<code>tar -zxvf jdk-8u202-linux-x64.tar.gz</code></p></li><li><p>环境变量配置：<code>sudo vi /etc/profile</code></p></li><li><p>添加以下内容：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">路径自己配自己的</span></span><br><span class="line">export JAVA_HOME=/home/dase-dis/jdk1.8.0_202</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.ja</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br></pre></td></tr></table></figure><ul><li><p>刷新：<code>source /etc/profile</code></p></li><li><p>验证：<code>java -version</code></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404301104527.png"></p>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]hexo博客 &amp; Github Pages部署记录</title>
      <link href="/2024/04/22/%E9%83%A8%E7%BD%B2-hexo%E5%8D%9A%E5%AE%A2-Github-Pages%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/04/22/%E9%83%A8%E7%BD%B2-hexo%E5%8D%9A%E5%AE%A2-Github-Pages%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Windows环境配置"><a href="#1-Windows环境配置" class="headerlink" title="1.Windows环境配置"></a>1.Windows环境配置</h1><ul><li><p>Git <a href="https://git-scm.com/">https://git-scm.com/</a></p></li><li><p>Node <a href="https://nodejs.org/en">https://nodejs.org/en</a></p></li><li><p>Pandoc <a href="https://pandoc.org/">https://pandoc.org/</a></p></li></ul><h1 id="2-安装Hexo"><a href="#2-安装Hexo" class="headerlink" title="2.安装Hexo"></a>2.安装Hexo</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npmmirror.com</span><br><span class="line"></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地测试</span></span><br><span class="line">hexo init # 初始化博客</span><br><span class="line">hexo generate # 申城网站信息</span><br><span class="line">hexo server # 开始网站服务</span><br></pre></td></tr></table></figure><h1 id="3-Github仓库"><a href="#3-Github仓库" class="headerlink" title="3.Github仓库"></a>3.Github仓库</h1><p>在你的github中新建仓库“username.github.io”，其中，username就是你注册时使用的用户名。</p><p>修改你博客根目录下的_config.yml文件中的deploy配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">   <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">   <span class="attr">repository:</span> <span class="string">git@github.com:username/username.github.io.git</span>  <span class="comment"># 你的仓库地址</span></span><br><span class="line">   <span class="attr">branch:</span> <span class="string">gh-pages</span></span><br></pre></td></tr></table></figure><p>他会在你的仓库的gh-pages分支部署你的页面，然后再master分支保存你网站的源代码，不会相互覆盖。</p><p>通过如下代码进行部署：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hexo clean # 清除缓存</span><br><span class="line">hexo generate # 生成网站</span><br><span class="line">hexo deploy # 部署至远程网络</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">简写</span></span><br><span class="line">hexo cl</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">简简写</span></span><br><span class="line">hexo cl</span><br><span class="line">hexo g -d  # hexo d -g</span><br></pre></td></tr></table></figure><p>然后就可以在浏览器上输入<a href="https://link.zhihu.com/?target=http://username.github.io">http://username.github.io</a>访问你的博客了。</p><h1 id="4-Github保存源码"><a href="#4-Github保存源码" class="headerlink" title="4.Github保存源码"></a>4.Github保存源码</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m &#x27;...&#x27;</span><br><span class="line"></span><br><span class="line">git remote add origin git@github.com:fengwm64/fengwm64.github.io.git</span><br><span class="line"></span><br><span class="line">git pull --rebase git@github.com:fengwm64/fengwm64.github.io.git master</span><br><span class="line"></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>设置<code>.gitignore</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br><span class="line">_multiconfig.yml</span><br><span class="line">public/</span><br></pre></td></tr></table></figure><p>再上GitHub设置master为主分支，删除main分支，以gh-pages分支部署Github Pages</p><h1 id="5-主题"><a href="#5-主题" class="headerlink" title="5.主题"></a>5.主题</h1><p><a href="https://github.com/saicaca/hexo-theme-vivia">https://github.com/saicaca/hexo-theme-vivia</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-theme-vivia</span><br><span class="line"></span><br><span class="line">mv node_modules/hexo-theme-vivia/example_zh_CN_config.vivia.yml _config.vivia.yml</span><br><span class="line"></span><br><span class="line">hexo config theme vivia</span><br><span class="line"></span><br><span class="line">hexo new page about</span><br></pre></td></tr></table></figure><p>编辑<code>_config.yml</code> 添加:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">archive_generator:</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="6-LaTex公式"><a href="#6-LaTex公式" class="headerlink" title="6.LaTex公式"></a>6.LaTex公式</h1><p><a href="https://github.com/next-theme/hexo-filter-mathjax">https://github.com/next-theme/hexo-filter-mathjax</a></p><p><a href="https://github.com/hexojs/hexo-renderer-pandoc">https://github.com/hexojs/hexo-renderer-pandoc</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-filter-mathjax</span><br><span class="line"></span><br><span class="line">hexo clean</span><br></pre></td></tr></table></figure><p>配置_config.yml:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">none</span> <span class="comment"># or &#x27;ams&#x27; or &#x27;all&#x27;</span></span><br><span class="line">  <span class="attr">single_dollars:</span> <span class="literal">true</span> <span class="comment"># enable single dollar signs as in-line math delimiters</span></span><br><span class="line">  <span class="attr">cjk_width:</span> <span class="number">0.9</span> <span class="comment"># relative CJK char width</span></span><br><span class="line">  <span class="attr">normal_width:</span> <span class="number">0.6</span> <span class="comment"># relative normal (monospace) width</span></span><br><span class="line">  <span class="attr">append_css:</span> <span class="literal">true</span> <span class="comment"># add CSS to pages rendered by MathJax</span></span><br><span class="line">  <span class="attr">every_page:</span> <span class="literal">true</span> <span class="comment"># if true, every page will be rendered by MathJax regardless the `mathjax` setting in Front-matter</span></span><br><span class="line">  <span class="attr">packages:</span> <span class="comment"># extra packages to load</span></span><br><span class="line">  <span class="attr">extension_options:</span> &#123;&#125;</span><br><span class="line">    <span class="comment"># you can put your extension options here</span></span><br><span class="line">    <span class="comment"># see http://docs.mathjax.org/en/latest/options/input/tex.html#tex-extension-options for more detail</span></span><br></pre></td></tr></table></figure><p>本地电脑安装配置Pandoc后：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked</span><br><span class="line"></span><br><span class="line">npm install hexo-renderer-pandoc --save</span><br></pre></td></tr></table></figure><h1 id="7-图床"><a href="#7-图床" class="headerlink" title="7.图床"></a>7.图床</h1><p>不重复造轮子，这篇知乎写得非常好了：</p><p><a href="https://zhuanlan.zhihu.com/p/112912928">https://zhuanlan.zhihu.com/p/112912928</a></p><h1 id="8-写作"><a href="#8-写作" class="headerlink" title="8.写作"></a>8.写作</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;[部署]hexo博客 &amp; Github Pages部署记录&quot;</span><br><span class="line"></span><br><span class="line">hexo cl</span><br><span class="line"></span><br><span class="line">hexo g -d</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m &#x27;...&#x27;</span><br><span class="line"></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><hr><p><strong>新电脑写作</strong></p><p>基本工作nodejs+git+pandoc，GitHub仓库上添加ssh公钥，在新电脑执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">cat C:\Users\Feng\.ssh\id_rsa.pub</span><br></pre></td></tr></table></figure><p>克隆项目：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:fengwm64/fengwm64.github.io.git</span><br><span class="line"></span><br><span class="line">cd .\fengwm64.github.io\</span><br><span class="line"></span><br><span class="line">npm config set registry https://registry.npmmirror.com</span><br><span class="line"></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"></span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line"></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>若npm install失败，管理员开启powershell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set-ExecutionPolicy RemoteSigned</span><br><span class="line"></span><br><span class="line">N</span><br></pre></td></tr></table></figure><p>验证：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -V</span><br></pre></td></tr></table></figure><p>重复 写作 部分</p>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[机器学习]线性回归</title>
      <link href="/2023/11/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/"/>
      <url>/2023/11/06/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/</url>
      
        <content type="html"><![CDATA[<h1 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h1><h2 id="1-1-闭式"><a href="#1-1-闭式" class="headerlink" title="1.1 闭式"></a>1.1 闭式</h2><ul><li><p><strong>模型：</strong>$h_\theta(x)&#x3D;\theta^TX$</p></li><li><p><strong>损失函数：</strong>$J(\theta)&#x3D;\left|X\theta-Y\right|_2^2$</p></li><li><p><strong>目标：</strong>$\theta&#x3D;\arg\min J(\theta)$</p></li><li><p><strong>说明：</strong>$\begin{cases}\theta\in\mathbb{R}^{d\times1}\[2ex]X\in\mathbb{R}^{m\times d}\[2ex]Y\in\mathbb{R}^{m\times1}\end{cases}$</p></li></ul><p>正规方程形式求解，即为直接求 $J(\theta)$ 的最小值：</p><p>先展开 $J(\theta)$ ：</p><p>$$\begin{align*}<br>J(\theta) &amp;&#x3D; |X\theta - Y|_{2}^{2} \<br>&amp;&#x3D; (X\theta - Y)^{T}(X\theta - Y) \<br>&amp;&#x3D; (X^{T}\theta^{T} - Y^{T})(X\theta - Y) \<br>&amp;&#x3D; X^{T}\theta^{T}X\theta - Y^{T}X\theta - Y^{T}X\theta + Y^{T}Y \<br>&amp;&#x3D; X^{T}\theta^{T}X\theta - 2Y^{T}X\theta + Y^{T}Y<br>\end{align*}<br>$$</p><p>对 $J(\theta)$ 进行求导：</p><p>$$\begin{aligned}<br>\frac{\partial J(\theta)}{\partial\theta}&amp; &#x3D;\frac{\partial X^T\theta^TX\theta-2Y^TX\theta+Y^TY}{\partial\theta} \<br>&amp;&#x3D;2X^{T}X\theta-2Y^{T}X<br>\end{aligned}$$</p><p>令 $J(\theta)&#x3D;0$ 得：</p><p>$$\begin{aligned}<br>2X^{T}X\theta-2Y^{T}X&amp; &#x3D;0 \<br>X^{T}X\theta &amp; &#x3D;Y^{T}X \<br>\theta &amp; &#x3D;(X^TX)^{-1}Y^TX<br>\end{aligned}$$</p><p>上述结果即为求解结果，需要说明的是：特征矩阵𝑿不满秩（即存在特征间的线性相关性），则正规方程求解过程中的矩阵求逆操作可能会导致数值不稳定性。</p><h2 id="1-2-梯度下降"><a href="#1-2-梯度下降" class="headerlink" title="1.2 梯度下降"></a>1.2 梯度下降</h2><ul><li><p><strong>模型：</strong>$h_\theta(x)&#x3D;\sum_{i&#x3D;1}^d\theta_ix_i$ </p><p>  注：$x_i$表示$x$的第$i$维</p></li><li><p><strong>损失函数：</strong>$J(\theta)&#x3D;\frac1{2m}\sum_{j&#x3D;0}^m\left(y^j-h_\theta(x^j)\right)^2$</p><p>  注：$x^j$表示第$j$个样本</p></li><li><p><strong>目标：</strong>$\theta&#x3D;\arg\min J(\theta)$</p></li><li><p><strong>说明：</strong>$\begin{cases}\theta\in\mathbb{R}^d\[2ex]x\in\mathbb{R}^d\[2ex]y\in\mathbb{R}^m\end{cases}$</p></li></ul><p>损失函数 $J(\theta)$ 是一个关于参数 $\theta$ 的二次型，对 $J(\theta)$ 进行展开：</p><p>$$\begin{aligned}<br>J(\theta)&amp; &#x3D;\frac{1}{2m}\sum_{j&#x3D;0}^{m}\Big(y^{j}-h_{\theta}(x^{j})\Big) \<br>&amp;&#x3D;\frac{1}{2m}\sum_{j&#x3D;0}^{m}\Bigg(y^{j}-\sum_{i&#x3D;1}^{d}\theta_{i}x_{i}^{j}\Bigg)^{2}<br>\end{aligned}$$</p><p>对 $J(\theta)$ 进行偏微分求导运算得到：</p><p>$$\begin{aligned}<br>\partial\frac{J(\theta)}{\partial\theta_i}&amp; &#x3D;\frac{\partial}{\partial\theta_{i}}\frac{1}{2m}\sum_{j&#x3D;0}^{m}\Bigg(y^{j}-\sum_{i&#x3D;1}^{d}\theta_{i}x_{i}^{j}\Bigg)^{2} \<br>&amp;&#x3D;\frac{1}{m}\sum_{j&#x3D;0}^{m}\Bigg( y^{j}-\sum_{i&#x3D;1}^{d}\theta_{i}x_{i}^{j}\Bigg)(-x_{i}^{j}) \<br>&amp;&#x3D;\frac{1}{m}\sum_{j&#x3D;0}^{m}\Bigg(\sum_{i&#x3D;1}^{d}\theta_{i}x_{i}^{j}-y^{j}\Bigg)x_{i}^{j}<br>\end{aligned}$$</p><p>每次根据梯度更新参数：</p><p>$$\begin{aligned}<br>\theta_{i}&amp; &#x3D;\theta_i-\alpha\partial\frac{J(\theta)}{\partial\theta_i} \<br>&amp;&#x3D;\theta_i-\alpha(\frac1m\sum_{j&#x3D;0}^m\biggl(\sum_{i&#x3D;1}^d\theta_ix_i^j-y^j\biggr)x_i^j) \<br>&amp;&#x3D;\theta_i+\alpha \frac{1}{m}\sum_{j&#x3D;0}^m\Bigg( y^j-\sum_{i&#x3D;1}^d\theta_ix_i^j\Bigg)x_i^j<br>\end{aligned}$$</p><p>梯度下降法步骤：</p><p>$\text{Repeat until convergence } {$<br>$$\theta_i:&#x3D;\theta_i+\alpha:\frac{1}{m}\sum_{j&#x3D;0}^m\Bigg(y^j-\sum_{i&#x3D;1}^d\theta_ix_i^j\Bigg)x_i^j$$<br>$}$</p><h1 id="2-Python实现"><a href="#2-Python实现" class="headerlink" title="2.Python实现"></a>2.Python实现</h1><h2 id="2-0-导包"><a href="#2-0-导包" class="headerlink" title="2.0 导包"></a>2.0 导包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入所需的包</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">from</span> sklearn.impute <span class="keyword">import</span> SimpleImputer</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="2-1-读取数据集"><a href="#2-1-读取数据集" class="headerlink" title="2.1 读取数据集"></a>2.1 读取数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">df = pd.read_csv(<span class="string">&quot;./housing.csv&quot;</span>)</span><br><span class="line"><span class="comment"># 预览数据</span></span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.info())</span><br></pre></td></tr></table></figure><h2 id="2-2-数据探索"><a href="#2-2-数据探索" class="headerlink" title="2.2 数据探索"></a>2.2 数据探索</h2><h3 id="2-2-1-数据分布情况"><a href="#2-2-1-数据分布情况" class="headerlink" title="2.2.1 数据分布情况"></a>2.2.1 数据分布情况</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">2</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">3</span>, <span class="number">3</span>, figsize=(<span class="number">18</span>, <span class="number">18</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 散点图看看价格/房子分布</span></span><br><span class="line">sns.scatterplot(data=df, x=<span class="string">&quot;longitude&quot;</span>, y=<span class="string">&quot;latitude&quot;</span>, size=<span class="string">&quot;median_house_value&quot;</span>, hue=<span class="string">&quot;median_house_value&quot;</span>, ax=ax[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直方图，正态否？</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">    <span class="keyword">if</span> col == <span class="string">&quot;longitude&quot;</span> <span class="keyword">or</span> col == <span class="string">&quot;latitude&quot;</span> <span class="keyword">or</span> col == <span class="string">&quot;ocean_proximity&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    sns.histplot(data=df[col], bins=<span class="number">60</span>, kde=<span class="literal">True</span>, ax=ax[(i - <span class="number">1</span>) // <span class="number">3</span>][(i - <span class="number">1</span>) % <span class="number">3</span>])</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分类变量</span></span><br><span class="line">sns.countplot(data=df,x=<span class="string">&quot;ocean_proximity&quot;</span>,ax=ax[<span class="number">2</span>][<span class="number">2</span>])</span><br></pre></td></tr></table></figure><h3 id="2-2-2-数据之间关系"><a href="#2-2-2-数据之间关系" class="headerlink" title="2.2.2 数据之间关系"></a>2.2.2 数据之间关系</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 距海远近 VS 房龄</span></span><br><span class="line">sns.displot(data=df,x=<span class="string">&quot;housing_median_age&quot;</span>,hue=<span class="string">&quot;ocean_proximity&quot;</span>,kind=<span class="string">&quot;kde&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># housing_median_age描述性统计</span></span><br><span class="line">df.groupby(<span class="string">&#x27;ocean_proximity&#x27;</span>)[<span class="string">&#x27;housing_median_age&#x27;</span>].describe()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 距海远近 VS 价格</span></span><br><span class="line">sns.displot(data=df,x=<span class="string">&quot;housing_median_age&quot;</span>,hue=<span class="string">&quot;ocean_proximity&quot;</span>,kind=<span class="string">&quot;kde&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># median_house_value描述性统计</span></span><br><span class="line">df.groupby(<span class="string">&#x27;ocean_proximity&#x27;</span>)[<span class="string">&#x27;median_house_value&#x27;</span>].describe()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续型 VS 连续型</span></span><br><span class="line">sns.pairplot(data=df.select_dtypes(include=<span class="string">&#x27;float64&#x27;</span>), kind=<span class="string">&#x27;reg&#x27;</span>, diag_kind=<span class="string">&#x27;hist&#x27;</span>)</span><br><span class="line">plt.savefig(<span class="string">&quot;1.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算变量之间的相关系数,皮尔逊相关系数展示线性相关关系</span></span><br><span class="line">df_corr = df.select_dtypes(include=<span class="string">&#x27;float64&#x27;</span>).corr()</span><br><span class="line">df_corr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制热力图</span></span><br><span class="line">sns.heatmap(df_corr, cmap=<span class="string">&quot;Blues&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="2-3-数据预处理"><a href="#2-3-数据预处理" class="headerlink" title="2.3 数据预处理"></a>2.3 数据预处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1）处理缺失值</span></span><br><span class="line"><span class="comment"># 取出有缺失值的列</span></span><br><span class="line"><span class="comment"># reshape是为了适应sklearn要求</span></span><br><span class="line">total_bedrooms = df.loc[:, <span class="string">&quot;total_bedrooms&quot;</span>].values.reshape(-<span class="number">1</span>, <span class="number">1</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制一份不破坏原数据</span></span><br><span class="line">filled_df = df.copy()  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 中位数填补</span></span><br><span class="line">filled_df.loc[:, <span class="string">&quot;total_bedrooms&quot;</span>] = SimpleImputer(strategy=<span class="string">&quot;median&quot;</span>).fit_transform(total_bedrooms)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 看一下效果</span></span><br><span class="line">filled_df.info()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2）编码</span></span><br><span class="line"><span class="comment"># 编码</span></span><br><span class="line">code = OneHotEncoder().fit_transform(filled_df.loc[:, <span class="string">&quot;ocean_proximity&quot;</span>].values.reshape(-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并</span></span><br><span class="line">coded_df = pd.concat([filled_df, pd.DataFrame(code.toarray())], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除原列</span></span><br><span class="line">coded_df.drop([<span class="string">&quot;ocean_proximity&quot;</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改下表头</span></span><br><span class="line">coded_df.columns = <span class="built_in">list</span>(coded_df.columns[:-<span class="number">5</span>]) + [<span class="string">&quot;ocean_0&quot;</span>, <span class="string">&quot;ocean_1&quot;</span>, <span class="string">&quot;ocean_2&quot;</span>, <span class="string">&quot;ocean_3&quot;</span>, <span class="string">&quot;ocean_4&quot;</span>]</span><br><span class="line"><span class="comment"># coded_df.columns = coded_df.columns.astype(str)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 看看效果</span></span><br><span class="line">coded_df.head(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><h2 id="2-4-划分数据集"><a href="#2-4-划分数据集" class="headerlink" title="2.4 划分数据集"></a>2.4 划分数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">feature = coded_df.iloc[:, :<span class="number">8</span>].join(coded_df.iloc[:, -<span class="number">5</span>:])</span><br><span class="line">label = coded_df[<span class="string">&quot;median_house_value&quot;</span>]</span><br><span class="line"></span><br><span class="line">Xtrain,Xtest,Ytrain,Ytest = train_test_split(feature,label,test_size=<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">Xtrain.head()</span><br></pre></td></tr></table></figure><h2 id="2-5-求解模型"><a href="#2-5-求解模型" class="headerlink" title="2.5 求解模型"></a>2.5 求解模型</h2><h3 id="2-5-0-评价指标R-2"><a href="#2-5-0-评价指标R-2" class="headerlink" title="2.5.0 评价指标R^2"></a>2.5.0 评价指标R^2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算R^2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">R2</span>(<span class="params">y, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> - (np.<span class="built_in">sum</span>((y - y_pred) ** <span class="number">2</span>) / np.<span class="built_in">sum</span>((y - np.mean(y)) ** <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="2-5-1-数据标准化"><a href="#2-5-1-数据标准化" class="headerlink" title="2.5.1 数据标准化"></a>2.5.1 数据标准化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据标准化</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">normalize</span>(<span class="params">X</span>):</span><br><span class="line">    sigma = np.std(X, axis=<span class="number">0</span>)</span><br><span class="line">    mu = np.mean(X, axis=<span class="number">0</span>)</span><br><span class="line">    X = (X - mu) / sigma</span><br><span class="line">    <span class="keyword">return</span> np.array(X)</span><br><span class="line"></span><br><span class="line">X = np.array(Xtrain).reshape(np.size(Xtrain, <span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">y = np.array(Ytrain).T.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化（闭式求解其实不需要，但梯度下降需要，为了对比统一都采用归一化）</span></span><br><span class="line">X = normalize(X)</span><br><span class="line">y = normalize(y)</span><br></pre></td></tr></table></figure><h3 id="2-5-2-闭合形式求解"><a href="#2-5-2-闭合形式求解" class="headerlink" title="2.5.2 闭合形式求解"></a>2.5.2 闭合形式求解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1）线性回归模型的闭合形式参数求解</span></span><br><span class="line"><span class="comment"># 正规方程求解</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Normal_Equation</span>(<span class="params">X, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.linalg.inv(X.T @ X) @ X.T @ y</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">theta_ne = Normal_Equation(X, y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;花费时间：<span class="subst">&#123;time.time() - start_time&#125;</span>&quot;</span>)v</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;R^2：<span class="subst">&#123;R2(y, X @ theta_ne)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 DataFrame</span></span><br><span class="line">result_cf = pd.DataFrame(&#123;<span class="string">&quot;ColumnName&quot;</span>: <span class="built_in">list</span>(Xtrain.columns), <span class="string">&quot;Theta&quot;</span>: theta_ne.flatten()&#125;)</span><br><span class="line">result_cf</span><br></pre></td></tr></table></figure><h3 id="2-5-3-梯度下降求解"><a href="#2-5-3-梯度下降求解" class="headerlink" title="2.5.3 梯度下降求解"></a>2.5.3 梯度下降求解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2）线性回归梯度下降参数求解</span></span><br><span class="line"><span class="comment"># 损失函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MSE_Loss</span>(<span class="params">y, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> np.<span class="built_in">sum</span>((y_pred - y) ** <span class="number">2</span>) / (<span class="number">2</span> * np.size(y))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 梯度下降</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GD</span>(<span class="params">X, y, lr=<span class="number">0.01</span>, epochs=<span class="number">5000</span></span>):</span><br><span class="line">    m, n = X.shape</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化参数为标准正态分布</span></span><br><span class="line">    theta = np.random.randn(n, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 记录每代损失</span></span><br><span class="line">    loss = np.zeros(epochs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">        <span class="comment"># 计算梯度</span></span><br><span class="line">        gradient = (<span class="number">1</span> / m) * (X.T @ (X @ theta - y))</span><br><span class="line">        <span class="comment"># 更新参数</span></span><br><span class="line">        theta -= lr * gradient</span><br><span class="line">        <span class="comment"># 记录损失</span></span><br><span class="line">        loss[epoch] = MSE_Loss(y, X @ theta)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> theta, loss</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">[theta_gd, loss] = GD(X, y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;花费时间：<span class="subst">&#123;time.time() - start_time&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;R^2：<span class="subst">&#123;R2(y, X @ theta_gd)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 DataFrame</span></span><br><span class="line">result_gd = pd.DataFrame(&#123;<span class="string">&quot;ColumnName&quot;</span>: <span class="built_in">list</span>(Xtrain.columns), <span class="string">&quot;Theta&quot;</span>: theta_gd.flatten()&#125;)</span><br><span class="line">result_gd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制损失函数梯度下降曲线</span></span><br><span class="line">sns.lineplot(x=np.arange(<span class="number">5000</span>), y=loss.flatten(), label=<span class="string">&#x27;Loss Curve&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epoch&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Gradient Descent Loss Curve&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="3-实验结果"><a href="#3-实验结果" class="headerlink" title="3.实验结果"></a>3.实验结果</h1><h2 id="3-1-探索数据特征"><a href="#3-1-探索数据特征" class="headerlink" title="3.1 探索数据特征"></a>3.1 探索数据特征</h2><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404241128729.png"></p><h2 id="3-2-求解结果展示"><a href="#3-2-求解结果展示" class="headerlink" title="3.2 求解结果展示"></a>3.2 求解结果展示</h2><p><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/202404241143950.png"></p>]]></content>
      
      
      <categories>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 线性回归 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[部署]WSL2 下 Bochs 环境配置记录</title>
      <link href="/2023/04/22/%E9%83%A8%E7%BD%B2-wsl2-bochs%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
      <url>/2023/04/22/%E9%83%A8%E7%BD%B2-wsl2-bochs%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<blockquote><p>WSL2 - Ubuntu 22.04 + VSCode + Bochs + XFCE4 + VcXsrv</p></blockquote><h2 id="笔者环境：WSL2-Ubuntu-22-04"><a href="#笔者环境：WSL2-Ubuntu-22-04" class="headerlink" title="笔者环境：WSL2 - Ubuntu 22.04"></a><strong>笔者环境：WSL2 - Ubuntu 22.04</strong></h2><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282017347.png" width="75%"><hr><h2 id="0-安装-WSL2-VSCode-终端"><a href="#0-安装-WSL2-VSCode-终端" class="headerlink" title="0. 安装 WSL2 &amp; VSCode &amp; 终端"></a>0. 安装 WSL2 &amp; VSCode &amp; 终端</h2><p>网上教程千千万，请自行查找：</p><ul><li><p><strong>WSL2</strong>：<a href="https://blog.csdn.net/weixin_42888638/article/details/127129727">WSL2 安装教程 - CSDN</a></p><ul><li><p>切换清华源：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">清华大学开源软件镜像站</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.bak</span><br><span class="line"><span class="built_in">sudo</span> vim /etc/apt/sources.list</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>VSCode</strong>：<a href="https://code.visualstudio.com/">Visual Studio Code 官网</a></p><ul><li>安装插件：WSL</li><li>点击左下绿色按钮，按提示连接 WSL。</li></ul></li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282017839.png" width="75%"><ul><li><strong>终端</strong>：Microsoft Store 提供下载。</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282018831.png" width="75%"><hr><h2 id="1-安装软件包"><a href="#1-安装软件包" class="headerlink" title="1. 安装软件包"></a>1. 安装软件包</h2><p>以下命令以行为单位粘贴到终端运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt upgrade</span><br><span class="line"><span class="built_in">sudo</span> apt-get install -y neofetch gcc vim build-essential g++ libgtk2.0-dev nasm gdb</span><br></pre></td></tr></table></figure><hr><h2 id="2-配置-WSL2-图形界面"><a href="#2-配置-WSL2-图形界面" class="headerlink" title="2. 配置 WSL2 图形界面"></a>2. 配置 WSL2 图形界面</h2><p>采用 <strong>XFCE4 + VcXsrv</strong>，实现图形化界面。</p><h3 id="2-1-安装-VcXsrv"><a href="#2-1-安装-VcXsrv" class="headerlink" title="2.1 安装 VcXsrv"></a>2.1 安装 VcXsrv</h3><p>下载地址：<a href="https://sourceforge.net/projects/vcxsrv/files/latest/download">VcXsrv 下载</a></p><ul><li><strong>安装过程：</strong></li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282018380.png" width="75%"><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282018860.png" width="75%"><ul><li>选择 <strong>One Large Window</strong>：</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282019190.png" width="75%"><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282019623.png" width="75%"><ul><li>勾选 <strong>Disable Access Control</strong>：</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282019762.png" width="75%"><ul><li>成功界面：</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282020653.png" width="75%"><ul><li><strong>解决高 DPI 模糊问题</strong>：</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282020086.png" width="75%"><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282020064.png" width="75%"><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282021124.png" width="75%"><hr><h3 id="2-2-安装-XFCE4"><a href="#2-2-安装-XFCE4" class="headerlink" title="2.2 安装 XFCE4"></a>2.2 安装 XFCE4</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y xfce4</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282021947.png" width="75%"><hr><h3 id="2-3-配置"><a href="#2-3-配置" class="headerlink" title="2.3 配置"></a>2.3 配置</h3><ul><li>修改 <code>.bashrc</code> 文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; vim .bashrc</span><br></pre></td></tr></table></figure><ul><li>在文件末尾添加：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DISPLAY=$(awk <span class="string">&#x27;/nameserver / &#123;print $2; exit&#125;&#x27;</span> /etc/resolv.conf 2&gt;/dev/null):0</span><br></pre></td></tr></table></figure><p>执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><hr><h3 id="2-4-启动-XFCE4"><a href="#2-4-启动-XFCE4" class="headerlink" title="2.4 启动 XFCE4"></a>2.4 启动 XFCE4</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> startxfce4</span><br></pre></td></tr></table></figure><ul><li>防火墙弹窗选择同意。</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282021946.png" width="75%"><ul><li><strong>小技巧</strong>：使用多终端避免 log 阻塞命令。</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282021851.png" width="75%"><ul><li><strong>解决锁屏卡死问题</strong>：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt purge xfce4-screensaver</span><br></pre></td></tr></table></figure><hr><h2 id="3-安装-Bochs"><a href="#3-安装-Bochs" class="headerlink" title="3. 安装 Bochs"></a>3. 安装 Bochs</h2><h3 id="3-1-下载与解压"><a href="#3-1-下载与解压" class="headerlink" title="3.1 下载与解压"></a>3.1 下载与解压</h3><ul><li>下载：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://sourceforge.net/projects/bochs/files/bochs/2.6.2/bochs-2.6.2.tar.gz</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282022435.png" width="75%"><ul><li>解压：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf bochs-2.6.2.tar.gz</span><br></pre></td></tr></table></figure><hr><h3 id="3-2-配置"><a href="#3-2-配置" class="headerlink" title="3.2 配置"></a>3.2 配置</h3><ul><li>进入目录并生成 Makefile：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> bochs-2.6.2</span><br><span class="line">./configure \</span><br><span class="line">--prefix=/your_path/bochs \</span><br><span class="line">--enable-debugger \</span><br><span class="line">--enable-disasm \</span><br><span class="line">--enable-iodebug \</span><br><span class="line">--enable-x86-debugger \</span><br><span class="line">--with-x \</span><br><span class="line">--with-x11 \</span><br><span class="line">LDFLAGS=<span class="string">&#x27;-pthread&#x27;</span> \</span><br><span class="line">LIBS=<span class="string">&#x27;-lX11&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>修改 <code>Makefile</code>：</li></ul><p>在第 92 行添加：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IBS =-lm -lgtk-x11-2.0 -lgdk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lgdk_pixbuf-2.0 -lpangocairo-1.0 -lcairo -lpango-1.0 -lfreetype -lfontconfig -lgobject-2.0 -lgmodule-2.0 -lglib-2.0 -lpthread</span><br></pre></td></tr></table></figure><hr><h3 id="3-3-编译安装"><a href="#3-3-编译安装" class="headerlink" title="3.3 编译安装"></a>3.3 编译安装</h3><ul><li>编译：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282023943.png" width="75%"><ul><li>安装：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282023112.png" width="75%"><hr><h3 id="3-4-配置-Bochs"><a href="#3-4-配置-Bochs" class="headerlink" title="3.4 配置 Bochs"></a>3.4 配置 Bochs</h3><ul><li>创建 <code>bochsrc.disk</code> 文件：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /home/fwm-0100/bochs/bin/bochsrc.disk</span><br></pre></td></tr></table></figure><ul><li>配置示例如下（路径需改为实际安装路径）：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">romimage: file=/home/fwm-0100/bochs/share/bochs/BIOS-bochs-latest</span><br><span class="line">vgaromimage: file=/home/fwm-0100/bochs/share/bochs/VGABIOS-lgpl-latest</span><br></pre></td></tr></table></figure><hr><h3 id="3-5-运行-Bochs"><a href="#3-5-运行-Bochs" class="headerlink" title="3.5 运行 Bochs"></a>3.5 运行 Bochs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/fwm-0100/bochs/bin</span><br><span class="line">./bochs</span><br></pre></td></tr></table></figure><ul><li>界面截图：</li></ul><img src="https://cdn.jsdelivr.net/gh/fengwm64/imgs/imgs/imgs202404282023846.png" width="75%"><hr><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li>《操作系统真相还原》</li><li><a href="https://www.cnblogs.com/blauendonau/p/14166062.html">VcXsrv 图形化界面 - 博客园</a></li><li><a href="https://blog.csdn.net/qq_45746571/article/details/129846595">WSL2 + Bochs 安装指南 - CSDN</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 部署记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WSL2 </tag>
            
            <tag> Bochs </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
